<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BetIQ Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--green:#00ff87;--green-dim:rgba(0,255,135,0.12);--red:#ff3d3d;--yellow:#ffd700;--bg:#050a05;--surface:#0d150d;--surface2:#141f14;--border:rgba(0,255,135,0.15);--text:#e8f5e8;--muted:#5a7a5a}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,255,135,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,135,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
.wrapper{position:relative;z-index:1;max-width:700px;margin:0 auto;padding:16px 14px 80px}
.header{text-align:center;padding:20px 0 14px}
.logo{font-family:'Bebas Neue',sans-serif;font-size:48px;letter-spacing:4px;color:var(--green);text-shadow:0 0 40px rgba(0,255,135,0.4)}
.logo span{color:var(--text)}
.tagline{font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--muted);margin-top:2px}
.live-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(255,61,61,0.15);border:1px solid var(--red);border-radius:20px;padding:3px 10px;font-size:10px;color:var(--red);font-family:'JetBrains Mono',monospace;margin-top:6px}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--red);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}
.tabs{display:flex;gap:6px;margin-bottom:14px;overflow-x:auto;padding-bottom:2px}
.tab-btn{flex-shrink:0;padding:10px 14px;border-radius:10px;border:1px solid rgba(0,255,135,0.2);background:var(--surface);color:var(--muted);font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;white-space:nowrap}
.tab-btn.active{background:var(--green-dim);border-color:var(--green);color:var(--green)}
.tab-content{display:none}.tab-content.active{display:block}
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:12px}
.section-label{font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--green);margin-bottom:10px;display:block}
.sport-tabs{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap}
.sport-tab{padding:6px 12px;border-radius:20px;border:1px solid rgba(0,255,135,0.15);background:var(--surface2);color:var(--muted);font-size:11px;cursor:pointer;transition:all 0.2s}
.sport-tab.active{border-color:var(--green);color:var(--green);background:var(--green-dim)}
.league-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:10px;max-height:260px;overflow-y:auto}
.league-btn{background:var(--surface2);border:1px solid rgba(0,255,135,0.1);border-radius:8px;padding:7px 5px;text-align:center;cursor:pointer;font-size:10px;color:var(--muted);transition:all 0.2s}
.league-btn:hover,.league-btn.active{border-color:var(--green);color:var(--green);background:var(--green-dim)}
.league-btn .flag{font-size:16px;display:block;margin-bottom:2px}
.fixtures-list{display:flex;flex-direction:column;gap:6px;margin-bottom:10px;max-height:240px;overflow-y:auto}
.fixture-item{background:var(--surface2);border:1px solid rgba(0,255,135,0.1);border-radius:8px;padding:10px 12px;cursor:pointer;transition:all 0.2s}
.fixture-item:hover,.fixture-item.selected{border-color:var(--green);background:var(--green-dim)}
.fixture-teams{font-size:13px;font-weight:600}
.fixture-meta{font-size:10px;color:var(--muted);margin-top:3px}
.fixture-time{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--yellow)}
.match-input-row{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;margin-bottom:10px}
.vs-badge{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--green);text-align:center}
input[type="text"],select{width:100%;background:var(--surface2);border:1px solid rgba(0,255,135,0.15);border-radius:10px;padding:11px 12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border-color 0.2s}
input[type="text"]:focus,select:focus{border-color:var(--green)}
input[type="text"]::placeholder{color:var(--muted)}
select option{background:#0d150d}
.markets-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-top:10px}
.market-toggle{display:flex;align-items:center;gap:7px;background:var(--surface2);border:1px solid rgba(0,255,135,0.1);border-radius:8px;padding:9px 10px;cursor:pointer;transition:all 0.2s;user-select:none}
.market-toggle.selected{border-color:var(--green);background:var(--green-dim)}
.market-toggle input{display:none}
.market-check{width:14px;height:14px;border:1px solid var(--muted);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:9px;flex-shrink:0}
.market-toggle.selected .market-check{background:var(--green);border-color:var(--green);color:#000}
.market-name{font-size:11px;font-weight:600}.market-desc{font-size:10px;color:var(--muted)}
.predict-btn{width:100%;background:var(--green);color:#000;border:none;border-radius:12px;padding:15px;font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;cursor:pointer;margin-top:12px;transition:all 0.2s}
.predict-btn:hover{transform:translateY(-1px);box-shadow:0 8px 30px rgba(0,255,135,0.3)}
.predict-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.loading{display:none;text-align:center;padding:30px;background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:12px}
.loading.show{display:block}
.spinner{width:36px;height:36px;border:2px solid rgba(0,255,135,0.2);border-top-color:var(--green);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--green)}
.loading-sub{font-size:11px;color:var(--muted);margin-top:4px}
.results{display:none}.results.show{display:block}
.match-header{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px;margin-bottom:10px;text-align:center}
.match-teams{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:2px;margin-bottom:4px}
.confidence-banner{display:inline-block;padding:5px 14px;border-radius:20px;font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;margin-top:8px}
.conf-high{background:rgba(0,255,135,0.15);color:var(--green);border:1px solid var(--green)}
.conf-med{background:rgba(255,215,0,0.15);color:var(--yellow);border:1px solid var(--yellow)}
.conf-low{background:rgba(255,61,61,0.15);color:var(--red);border:1px solid var(--red)}
.market-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;margin-bottom:8px;position:relative;overflow:hidden}
.market-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--green)}
.market-card.warning::before{background:var(--yellow)}.market-card.danger::before{background:var(--red)}
.market-card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.market-card-name{font-size:10px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;font-family:'JetBrains Mono',monospace}
.market-card-verdict{font-family:'Bebas Neue',sans-serif;font-size:14px;padding:2px 8px;border-radius:5px}
.verdict-yes{background:rgba(0,255,135,0.15);color:var(--green)}.verdict-no{background:rgba(255,61,61,0.15);color:var(--red)}.verdict-maybe{background:rgba(255,215,0,0.15);color:var(--yellow)}
.market-card-prediction{font-size:16px;font-weight:600;margin-bottom:6px}
.prob-bar-wrap{margin-bottom:4px}
.prob-label{display:flex;justify-content:space-between;font-size:10px;color:var(--muted);margin-bottom:3px}
.prob-bar{height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
.prob-fill{height:100%;border-radius:3px;background:var(--green);transition:width 1s ease}
.prob-fill.danger{background:var(--red)}.prob-fill.warning{background:var(--yellow)}
.market-reasoning{font-size:11px;color:var(--muted);line-height:1.5;margin-top:6px}
.h2h-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:10px}
.h2h-overview{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;margin-bottom:16px}
.h2h-team-stat{text-align:center}
.h2h-wins{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--green)}
.h2h-label{font-size:10px;color:var(--muted);letter-spacing:1px}
.h2h-draw-box{text-align:center;padding:8px 12px;background:var(--surface2);border-radius:8px}
.h2h-draw-num{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--yellow)}
.h2h-bar{display:flex;height:8px;border-radius:4px;overflow:hidden;margin-bottom:16px}
.h2h-bar-home{background:var(--green)}.h2h-bar-draw{background:var(--yellow)}.h2h-bar-away{background:var(--red)}
.h2h-match{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(0,255,135,0.06);font-size:12px}
.h2h-match:last-child{border-bottom:none}
.h2h-score{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--yellow)}
.h2h-result-badge{padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700}
.badge-h{background:rgba(0,255,135,0.15);color:var(--green)}.badge-d{background:rgba(255,215,0,0.15);color:var(--yellow)}.badge-a{background:rgba(255,61,61,0.15);color:var(--red)}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.stat-box{background:var(--surface2);border-radius:10px;padding:12px;text-align:center}
.stat-num{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--green)}
.stat-label{font-size:10px;color:var(--muted);margin-top:2px}
.odds-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:8px;position:relative}
.odds-badge{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;padding:3px 8px;border-radius:5px;background:rgba(255,215,0,0.15);color:var(--yellow);border:1px solid var(--yellow)}
.remove-btn{position:absolute;top:10px;right:10px;background:none;border:none;color:var(--muted);font-size:14px;cursor:pointer}
.total-odds-bar{background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(0,255,135,0.08));border:1px solid var(--yellow);border-radius:12px;padding:14px 18px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.total-odds-num{font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--yellow)}
.odds-generator-result{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px}
.bet-slip-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(0,255,135,0.06);font-size:12px}
.bet-slip-item:last-child{border-bottom:none}
.slip-odds{font-family:'JetBrains Mono',monospace;color:var(--yellow);font-weight:700;font-size:13px}
.slip-prob{font-size:10px;color:var(--muted)}
.pick-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.pick-btn{background:var(--surface2);border:1px solid rgba(0,255,135,0.1);border-radius:7px;padding:8px 5px;text-align:center;cursor:pointer;font-size:10px;color:var(--muted);transition:all 0.2s}
.pick-btn.active{border-color:var(--green);color:var(--green);background:var(--green-dim)}
.best-bet-banner{background:rgba(0,255,135,0.08);border:1px solid var(--green);border-radius:12px;padding:12px 16px;margin-bottom:10px;display:flex;align-items:center;gap:10px}
.factors-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px}
.factor-item{display:flex;gap:8px;padding:7px 0;border-bottom:1px solid rgba(0,255,135,0.05);font-size:12px;line-height:1.5}
.factor-item:last-child{border-bottom:none}
.error-msg{background:rgba(255,61,61,0.1);border:1px solid rgba(255,61,61,0.3);border-radius:10px;padding:12px;font-size:13px;color:var(--red);margin-bottom:10px;display:none}
.error-msg.show{display:block}
.disclaimer{text-align:center;font-size:10px;color:var(--muted);padding:10px;line-height:1.6}
.fixtures-loading{text-align:center;padding:20px;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="logo">Bet<span>IQ</span> <span style="font-size:20px;vertical-align:middle">Pro</span></div>
    <div class="tagline">Ultimate AI Match Predictor</div>
    <div class="live-badge"><div class="live-dot"></div> LIVE DATA</div>
  </div>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab(1)">‚öΩ Predict</button>
    <button class="tab-btn" onclick="switchTab(2)">üìä H2H Stats</button>
    <button class="tab-btn" onclick="switchTab(3)">üìã Accumulator</button>
    <button class="tab-btn" onclick="switchTab(4)">üî• Smart Odds</button>
  </div>

  <!-- TAB 1 -->
  <div class="tab-content active" id="tabContent1">
    <div class="card">
      <span class="section-label">üèÖ Sport</span>
      <div class="sport-tabs">
        <div class="sport-tab active" onclick="selectSport(this,'football')">‚öΩ Football</div>
        <div class="sport-tab" onclick="selectSport(this,'basketball')">üèÄ Basketball</div>
        <div class="sport-tab" onclick="selectSport(this,'tennis')">üèì Table Tennis</div>
        <div class="sport-tab" onclick="selectSport(this,'darts')">üéØ Darts</div>
      </div>
      <span class="section-label">üåç League</span>
      <div class="league-grid" id="leagueGrid1"></div>
      <span class="section-label">üìÖ Today's Fixtures <span id="fixturesCount" style="color:var(--muted)"></span></span>
      <div class="fixtures-list" id="fixturesList"><div class="fixtures-loading">Loading fixtures...</div></div>
      <span class="section-label">‚úèÔ∏è Or Type Teams</span>
      <div class="match-input-row">
        <input type="text" id="homeTeam" placeholder="Home Team"/>
        <div class="vs-badge">VS</div>
        <input type="text" id="awayTeam" placeholder="Away Team"/>
      </div>
      <span class="section-label">üìä Markets</span>
      <div class="markets-grid" id="marketsGrid"></div>
      <button class="predict-btn" onclick="predict()" id="predictBtn">‚ö° ANALYSE MATCH</button>
    </div>
    <div class="error-msg" id="errorMsg"></div>
    <div class="loading" id="loading"><div class="spinner"></div><div class="loading-text">ANALYSING...</div><div class="loading-sub" id="loadingStep">Fetching data</div></div>
    <div class="results" id="results"></div>
  </div>

  <!-- TAB 2 -->
  <div class="tab-content" id="tabContent2">
    <div class="card">
      <span class="section-label">üìä Head to Head Statistics</span>
      <div class="match-input-row">
        <input type="text" id="h2hHome" placeholder="Home Team"/>
        <div class="vs-badge">VS</div>
        <input type="text" id="h2hAway" placeholder="Away Team"/>
      </div>
      <button class="predict-btn" onclick="loadH2H()" style="font-size:16px;padding:13px">üîç GET H2H STATS</button>
    </div>
    <div class="error-msg" id="h2hError"></div>
    <div class="loading" id="h2hLoading" style="display:none"><div class="spinner"></div><div class="loading-text">FETCHING H2H...</div><div class="loading-sub">Searching match history</div></div>
    <div id="h2hResults"></div>
  </div>

  <!-- TAB 3 -->
  <div class="tab-content" id="tabContent3">
    <div class="card">
      <span class="section-label">üåç League</span>
      <div class="league-grid" id="leagueGrid3"></div>
      <span class="section-label">üìÖ Select Fixture</span>
      <div class="fixtures-list" id="accumFixtures"><div class="fixtures-loading">Select league above</div></div>
      <span class="section-label" style="margin-top:8px">Or Type Teams</span>
      <div class="match-input-row">
        <input type="text" id="accumHome" placeholder="Home Team"/>
        <div class="vs-badge">VS</div>
        <input type="text" id="accumAway" placeholder="Away Team"/>
      </div>
      <span class="section-label">Pick Type</span>
      <div class="pick-grid" id="pickGrid"></div>
      <button class="predict-btn" onclick="addToAccum()" style="font-size:15px;padding:12px;margin-top:10px">+ ADD TO ACCUMULATOR</button>
    </div>
    <div class="error-msg" id="accumError"></div>
    <div id="accumList"></div>
    <div class="total-odds-bar" id="totalOddsBar" style="display:none">
      <div><div style="font-size:10px;letter-spacing:2px;color:var(--muted);font-family:'JetBrains Mono',monospace">TOTAL ODDS</div>
      <div class="total-odds-num" id="totalOddsNum">1.00</div>
      <div style="font-size:11px;color:var(--muted)" id="totalOddsInfo"></div></div>
      <div style="text-align:right"><div style="font-size:11px;color:var(--muted);margin-bottom:4px">Win probability</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:18px;color:var(--green)" id="totalProbNum">-</div>
      <button onclick="clearAccum()" style="margin-top:8px;background:rgba(255,61,61,0.15);border:1px solid var(--red);border-radius:6px;padding:4px 10px;color:var(--red);font-size:11px;cursor:pointer">Clear All</button></div>
    </div>
  </div>

  <!-- TAB 4 -->
  <div class="tab-content" id="tabContent4">
    <div class="card">
      <span class="section-label">üî• Smart Odds Generator</span>
      <span class="section-label">Target Odds</span>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:12px">
        <div class="pick-btn active" id="odds_2" onclick="selOdds(this,'2-10')">‚úÖ 2x-10x</div>
        <div class="pick-btn" id="odds_50" onclick="selOdds(this,'50-100')">üî• 50x-100x</div>
        <div class="pick-btn" id="odds_100" onclick="selOdds(this,'100-200')">‚ö° 100x-200x</div>
        <div class="pick-btn" id="odds_200" onclick="selOdds(this,'200-500')">üí• 200x-500x</div>
        <div class="pick-btn" id="odds_any" onclick="selOdds(this,'any')">üé≤ Any</div>
      </div>
      <span class="section-label">Matches</span>
      <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:6px;margin-bottom:12px">
        <div class="pick-btn" id="nm_3" onclick="selNum(this,3)">3</div>
        <div class="pick-btn" id="nm_4" onclick="selNum(this,4)">4</div>
        <div class="pick-btn active" id="nm_5" onclick="selNum(this,5)">5</div>
        <div class="pick-btn" id="nm_6" onclick="selNum(this,6)">6</div>
        <div class="pick-btn" id="nm_7" onclick="selNum(this,7)">7</div>
        <div class="pick-btn" id="nm_8" onclick="selNum(this,8)">8</div>
      </div>
      <span class="section-label">Market Type</span>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:12px">
        <div class="pick-btn active" id="mt_all" onclick="selMkt(this,'all')">All</div>
        <div class="pick-btn" id="mt_goals" onclick="selMkt(this,'goals')">Goals</div>
        <div class="pick-btn" id="mt_wins" onclick="selMkt(this,'wins')">Wins</div>
        <div class="pick-btn" id="mt_btts" onclick="selMkt(this,'btts')">BTTS</div>
        <div class="pick-btn" id="mt_ht" onclick="selMkt(this,'ht')">Half Time</div>
        <div class="pick-btn" id="mt_sure" onclick="selMkt(this,'sure')">Sure Bets</div>
      </div>
      <button class="predict-btn" onclick="generateSmartOdds()">üé≤ GENERATE SLIP</button>
    </div>
    <div id="smartResults"></div>
  </div>

  <div class="disclaimer">‚ö†Ô∏è BetIQ Pro is for entertainment only. Always gamble responsibly.</div>
</div>

<script>
const API_KEY='3e5b8ca770mshc97d61fadb78057p15a945jsn16814450fa8f';

const FOOTBALL_LEAGUES=[
  {n:'Premier League',f:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',id:'17'},
  {n:'La Liga',f:'üá™üá∏',id:'8'},
  {n:'Serie A',f:'üáÆüáπ',id:'23'},
  {n:'Bundesliga',f:'üá©üá™',id:'35'},
  {n:'Ligue 1',f:'üá´üá∑',id:'34'},
  {n:'Champions League',f:'‚≠ê',id:'7'},
  {n:'Europa League',f:'üü†',id:'679'},
  {n:'Championship',f:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',id:'18'},
  {n:'League One',f:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',id:'19'},
  {n:'Serie B',f:'üáÆüáπ',id:'24'},
  {n:'2. Bundesliga',f:'üá©üá™',id:'44'},
  {n:'Eredivisie',f:'üá≥üá±',id:'37'},
  {n:'Primeira Liga',f:'üáµüáπ',id:'38'},
  {n:'Super Lig',f:'üáπüá∑',id:'52'},
  {n:'MLS',f:'üá∫üá∏',id:'242'},
  {n:'Saudi Pro',f:'üá∏üá¶',id:'955'},
  {n:'Ligue 2',f:'üá´üá∑',id:'182'},
  {n:'Conference League',f:'üü£',id:'680'},
];

const STATIC={
  basketball:{
    'NBA':[['LA Lakers','Boston Celtics'],['Golden State','Phoenix Suns'],['Milwaukee Bucks','Miami Heat'],['Denver Nuggets','Dallas Mavericks']],
    'EuroLeague':[['Real Madrid','Fenerbahce'],['Barcelona','Anadolu Efes'],['CSKA Moscow','Olympiakos']]
  },
  tennis:{
    'World TT':[['Fan Zhendong','Ma Long'],['Timo Boll','Hugo Calderano'],['Wang Chuqin','Truls Moregard']]
  },
  darts:{
    'PDC':[['Michael van Gerwen','Peter Wright'],['Gerwyn Price','Luke Littler'],['Gary Anderson','Michael Smith']]
  }
};

let currentSport='football',currentLeagueId='17',currentLeagueName='Premier League';
let accumPickType='Home Win',accumItems=[],selOddsRange='2-10',selNumM=5,selMktType='all';
let fixturesCache={};

function init(){renderLeagues('leagueGrid1');renderLeagues('leagueGrid3');renderMarkets();renderPickGrid();loadSofaFixtures('fixturesList',currentLeagueId);}
function switchTab(n){document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',i+1===n));document.querySelectorAll('.tab-content').forEach((c,i)=>c.classList.toggle('active',i+1===n));}

function selectSport(el,sport){
  document.querySelectorAll('.sport-tab').forEach(b=>b.classList.remove('active'));el.classList.add('active');currentSport=sport;
  renderLeagues('leagueGrid1');renderMarkets();
  if(sport!=='football'){const keys=Object.keys(STATIC[sport]||{});if(keys.length)renderStaticFix('fixturesList',sport,keys[0]);}
}

function renderLeagues(gid){
  const g=document.getElementById(gid);
  if(currentSport==='football'){
    g.innerHTML=FOOTBALL_LEAGUES.map((l,i)=>`<div class="league-btn${i===0?' active':''}" onclick="onLeague(this,'${gid}','${l.id}','${l.n}')">${l.f?`<span class="flag">${l.f}</span>`:''}${l.n}</div>`).join('');
  } else {
    const leagues=Object.keys(STATIC[currentSport]||{});
    g.innerHTML=leagues.map((l,i)=>`<div class="league-btn${i===0?' active':''}" onclick="onStaticLeague(this,'${gid}','${l}')">${l}</div>`).join('');
  }
}

function onLeague(el,gid,id,name){
  document.querySelectorAll(`#${gid} .league-btn`).forEach(b=>b.classList.remove('active'));el.classList.add('active');
  currentLeagueId=id;currentLeagueName=name;
  const fid=gid==='leagueGrid1'?'fixturesList':'accumFixtures';
  loadSofaFixtures(fid,id);
}

function onStaticLeague(el,gid,name){
  document.querySelectorAll(`#${gid} .league-btn`).forEach(b=>b.classList.remove('active'));el.classList.add('active');
  const fid=gid==='leagueGrid1'?'fixturesList':'accumFixtures';
  renderStaticFix(fid,currentSport,name);
}

function renderStaticFix(cid,sport,league){
  const c=document.getElementById(cid);
  const matches=(STATIC[sport]||{})[league]||[];
  c.innerHTML=matches.length?matches.map(([h,a])=>`<div class="fixture-item" onclick="selFix(this,'${h}','${a}','${cid}')"><div class="fixture-teams">${h} vs ${a}</div><div class="fixture-meta">${league}</div></div>`).join(''):'<div class="fixtures-loading">No fixtures</div>';
}

async function loadSofaFixtures(cid,leagueId){
  const c=document.getElementById(cid);
  c.innerHTML='<div class="fixtures-loading">‚è≥ Loading live fixtures...</div>';
  if(fixturesCache[leagueId]){renderSofaFix(cid,fixturesCache[leagueId]);return;}
  try{
    const today=new Date();
    const d=`${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    const res=await fetch(`https://sofascore.p.rapidapi.com/tournaments/get-scheduled-events?tournamentId=${leagueId}&date=${d}`,{
      headers:{'x-rapidapi-key':API_KEY,'x-rapidapi-host':'sofascore.p.rapidapi.com'}
    });
    const data=await res.json();
    const events=data.events||data.data||[];
    fixturesCache[leagueId]=events;
    renderSofaFix(cid,events);
  } catch(e){
    c.innerHTML='<div class="fixtures-loading" style="color:var(--yellow)">‚ö†Ô∏è Type teams manually below</div>';
  }
}

function renderSofaFix(cid,events){
  const c=document.getElementById(cid);
  if(!events||!events.length){c.innerHTML='<div class="fixtures-loading">No fixtures today ‚Äî type manually</div>';return;}
  if(cid==='fixturesList')document.getElementById('fixturesCount').textContent=`(${events.length})`;
  c.innerHTML=events.slice(0,20).map(e=>{
    const home=e.homeTeam?.name||e.home?.name||'Home';
    const away=e.awayTeam?.name||e.away?.name||'Away';
    const ts=e.startTimestamp||e.dateTime;
    const timeStr=ts?new Date(ts*1000).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):'';
    return `<div class="fixture-item" onclick="selFix(this,'${home}','${away}','${cid}')">
      <div class="fixture-teams">${home} vs ${away}</div>
      <div style="display:flex;justify-content:space-between;margin-top:3px">
        <div class="fixture-meta">${currentLeagueName}</div>
        ${timeStr?`<div class="fixture-time">üïê ${timeStr}</div>`:''}
      </div></div>`;
  }).join('');
}

function selFix(el,home,away,cid){
  document.querySelectorAll(`#${cid} .fixture-item`).forEach(f=>f.classList.remove('selected'));el.classList.add('selected');
  if(cid==='fixturesList'){document.getElementById('homeTeam').value=home;document.getElementById('awayTeam').value=away;}
  else{document.getElementById('accumHome').value=home;document.getElementById('accumAway').value=away;}
}

// Markets
const FM=[{v:'Home Win',n:'Home Win',d:'Straight home win'},{v:'Away Win',n:'Away Win',d:'Straight away win'},{v:'Draw',n:'Draw',d:'Match level'},{v:'Home Win/Draw',n:'Home W/D',d:'1X double chance'},{v:'Away Win/Draw',n:'Away W/D',d:'X2 double chance'},{v:'BTTS',n:'BTTS Yes',d:'Both score'},{v:'BTTS No',n:'BTTS No',d:'Clean sheet'},{v:'Over 1.5',n:'Over 1.5',d:'2+ goals'},{v:'Over 2.5',n:'Over 2.5',d:'3+ goals'},{v:'Over 3.5',n:'Over 3.5',d:'4+ goals'},{v:'Under 2.5',n:'Under 2.5',d:'2 or less'},{v:'Under 3.5',n:'Under 3.5',d:'3 or less'},{v:'Under 4.5',n:'Under 4.5',d:'4 or less'},{v:'HT Home Win',n:'HT Home Win',d:'Home HT'},{v:'HT Draw',n:'HT Draw',d:'Level HT'},{v:'HT Away Win',n:'HT Away Win',d:'Away HT'},{v:'HT Home Win/Draw',n:'HT H W/D',d:'Home or level HT'},{v:'Corners Over 7.5',n:'Corners O7.5',d:'8+ corners'},{v:'Corners Over 9.5',n:'Corners O9.5',d:'10+ corners'}];
const BM=[{v:'Home Win',n:'Home Win',d:'Home wins'},{v:'Away Win',n:'Away Win',d:'Away wins'},{v:'Over 210.5',n:'O 210.5 Pts',d:'211+ pts'},{v:'Over 220.5',n:'O 220.5 Pts',d:'221+ pts'},{v:'Under 210.5',n:'U 210.5 Pts',d:'210 or less'}];
const TM=[{v:'Home Win',n:'P1 Win',d:'Player 1 wins'},{v:'Away Win',n:'P2 Win',d:'Player 2 wins'},{v:'Over 3.5 Sets',n:'O 3.5 Sets',d:'4+ sets'},{v:'Under 3.5 Sets',n:'U 3.5 Sets',d:'3 or less'}];
const DM=[{v:'Home Win',n:'P1 Win',d:'Player 1 wins'},{v:'Away Win',n:'P2 Win',d:'Player 2 wins'},{v:'Over 5.5 Sets',n:'O 5.5 Sets',d:'6+ sets'},{v:'180s Over 3.5',n:'180s O3.5',d:'4+ maximums'}];

function renderMarkets(){
  const ml=currentSport==='football'?FM:currentSport==='basketball'?BM:currentSport==='tennis'?TM:DM;
  const g=document.getElementById('marketsGrid');
  g.innerHTML=ml.map((m,i)=>`<label class="market-toggle${i<4?' selected':''}"><input type="checkbox"${i<4?' checked':''} value="${m.v}"><div class="market-check">${i<4?'‚úì':''}</div><div><div class="market-name">${m.n}</div><div class="market-desc">${m.d}</div></div></label>`).join('');
  g.querySelectorAll('.market-toggle').forEach(t=>{t.addEventListener('click',()=>{const cb=t.querySelector('input');cb.checked=!cb.checked;t.classList.toggle('selected',cb.checked);t.querySelector('.market-check').textContent=cb.checked?'‚úì':'';});});
}

function renderPickGrid(){
  const picks=['Home Win','Away Win','Draw','BTTS Yes','Over 2.5','Over 1.5','Under 2.5','Over 3.5','HT Draw','HT Home Win','Corners O9.5','DNB Home'];
  document.getElementById('pickGrid').innerHTML=picks.map((p,i)=>`<div class="pick-btn${i===0?' active':''}" onclick="selPick(this,'${p}')">${p}</div>`).join('');
}
function selPick(el,t){document.querySelectorAll('#pickGrid .pick-btn').forEach(b=>b.classList.remove('active'));el.classList.add('active');accumPickType=t;}

// Prediction engine
const TS={'Man City':{att:92,def:88,form:85,home:90},'Arsenal':{att:88,def:85,form:87,home:86},'Liverpool':{att:90,def:83,form:88,home:89},'Chelsea':{att:78,def:75,form:72,home:76},'Man Utd':{att:72,def:68,form:65,home:70},'Tottenham':{att:76,def:70,form:68,home:72},'Newcastle':{att:78,def:79,form:76,home:80},'Aston Villa':{att:77,def:75,form:74,home:76},'Real Madrid':{att:94,def:87,form:90,home:93},'Barcelona':{att:91,def:82,form:86,home:90},'Atletico Madrid':{att:79,def:88,form:80,home:84},'PSG':{att:94,def:82,form:88,home:92},'Bayern Munich':{att:93,def:85,form:88,home:92},'Dortmund':{att:84,def:75,form:80,home:82},'Inter Milan':{att:87,def:86,form:85,home:88},'Juventus':{att:78,def:82,form:76,home:80},'AC Milan':{att:80,def:79,form:78,home:82},'Napoli':{att:83,def:78,form:80,home:84},'Al Hilal':{att:86,def:82,form:84,home:88},'Al Nassr':{att:83,def:78,form:80,home:84},'LA Lakers':{att:88,def:82,form:80,home:85},'Boston Celtics':{att:90,def:88,form:87,home:88},'Fan Zhendong':{att:97,def:95,form:96,home:92},'Ma Long':{att:95,def:94,form:90,home:88},'Michael van Gerwen':{att:97,def:95,form:93,home:92},'Luke Littler':{att:93,def:88,form:92,home:90}};
function gs(n){const k=Object.keys(TS).find(k=>k.toLowerCase()===n.toLowerCase()||n.toLowerCase().includes(k.toLowerCase())||k.toLowerCase().includes(n.toLowerCase()));return k?TS[k]:{att:72,def:70,form:70,home:72};}
function rnd(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function clamp(v,a,b){return Math.min(b,Math.max(a,v));}

function calc(home,away){
  const h=gs(home),a=gs(away);
  const hS=h.att*0.4+h.def*0.3+h.form*0.2+h.home*0.1;
  const aS=(a.att*0.4+a.def*0.3+a.form*0.2)*0.92;
  const tot=hS+aS+15;
  let hw=clamp(Math.round(hS/tot*100)+rnd(-4,4),22,72);
  let aw=clamp(Math.round(aS/tot*100)+rnd(-4,4),12,52);
  let d=clamp(100-hw-aw,14,34);
  const s=hw+aw+d;hw=Math.round(hw/s*100);aw=Math.round(aw/s*100);d=100-hw-aw;
  const avg=((h.att+a.att)/2/100)*3.2+rnd(-3,3)/10;
  const btts=clamp(Math.round((h.att+a.att)/2*0.85)+rnd(-7,7),32,80);
  const o25=clamp(Math.round(avg*28)+rnd(-7,7),28,78);
  return{hw,aw,d,h,a,avg,btts,o25,o15:clamp(o25+rnd(12,20),52,92),o35:clamp(o25-rnd(18,28),12,50),htHW:clamp(hw-rnd(8,15),18,55),htD:clamp(d+rnd(5,12),28,48),htAW:clamp(aw-rnd(5,12),10,38),corners:clamp(rnd(60,80),50,85)};
}

function getMktPred(mkt,home,away,p){
  const map={
    'Home Win':{pred:`${home} Win`,prob:p.hw,r:`${home} have ${p.hw}% win probability with home advantage and form (${p.h.form}/100).`},
    'Away Win':{pred:`${away} Win`,prob:p.aw,r:`${away} carry ${p.aw}% win probability. Attack rating ${p.a.att}/100.`},
    'Draw':{pred:'Draw',prob:p.d,r:`Draw probability ${p.d}%. Evenly matched fixture.`},
    'Home Win/Draw':{pred:`${home} Win or Draw`,prob:clamp(p.hw+p.d,40,88),r:`1X probability ${clamp(p.hw+p.d,40,88)}%.`},
    'Away Win/Draw':{pred:`${away} Win or Draw`,prob:clamp(p.aw+p.d,35,82),r:`X2 probability ${clamp(p.aw+p.d,35,82)}%.`},
    'BTTS':{pred:p.btts>52?'BTTS Yes':'BTTS No',prob:p.btts,r:`Combined attack avg ${Math.round((p.h.att+p.a.att)/2)}/100. ${p.btts>55?'Both capable of scoring.':'Clean sheet possible.'}`},
    'BTTS No':{pred:'BTTS No',prob:100-p.btts,r:`${100-p.btts}% clean sheet probability.`},
    'Over 1.5':{pred:'Over 1.5 Goals',prob:p.o15,r:`${p.o15}% chance of 2+ goals. Expected ${p.avg.toFixed(1)} goals.`},
    'Over 2.5':{pred:p.o25>50?'Over 2.5':'Under 2.5',prob:p.o25,r:`Expected ${p.avg.toFixed(1)} goals. ${p.o25>55?'High scoring likely.':'Could be tight.'}`},
    'Over 3.5':{pred:p.o35>40?'Over 3.5':'Under 3.5',prob:p.o35,r:`4+ goals ${p.o35}% probability.`},
    'Under 2.5':{pred:'Under 2.5 Goals',prob:100-p.o25,r:`${100-p.o25}% chance of 2 or less goals.`},
    'Under 3.5':{pred:'Under 3.5 Goals',prob:clamp(100-p.o35+rnd(10,20),55,88),r:`High probability market ‚Äî most matches under 3.5.`},
    'Under 4.5':{pred:'Under 4.5 Goals',prob:clamp(100-p.o35+rnd(20,30),70,95),r:`Very high probability. Rarely do matches exceed 4.5 goals.`},
    'HT Home Win':{pred:`${home} HT Win`,prob:p.htHW,r:`${home} score first in ${p.htHW}% of home games.`},
    'HT Draw':{pred:'HT Draw',prob:p.htD,r:`HT draw most common result at ${p.htD}%. Teams cautious early.`},
    'HT Away Win':{pred:`${away} HT Win`,prob:p.htAW,r:`${away} lead at HT in ${p.htAW}% of away fixtures.`},
    'HT Home Win/Draw':{pred:`${home} HT W/D`,prob:clamp(p.htHW+p.htD,45,82),r:`${home} winning or level at HT ‚Äî ${clamp(p.htHW+p.htD,45,82)}%.`},
    'Corners Over 7.5':{pred:'Over 7.5 Corners',prob:p.corners,r:`${p.corners}% chance of 8+ corners.`},
    'Corners Over 9.5':{pred:'Over 9.5 Corners',prob:clamp(p.corners-rnd(15,20),35,68),r:`10+ corners ‚Äî ${clamp(p.corners-rnd(15,20),35,68)}%.`},
    'Over 210.5':{pred:'Over 210.5 Pts',prob:clamp((p.h.att+p.a.att)/2,45,80),r:`NBA pace and offence suggest high total.`},
    'Over 220.5':{pred:'Over 220.5 Pts',prob:clamp((p.h.att+p.a.att)/2-rnd(5,15),35,72),r:`220+ combined needs both teams firing.`},
    'Under 210.5':{pred:'Under 210.5 Pts',prob:clamp(100-(p.h.att+p.a.att)/2,30,65),r:`Defensive game or slow pace could limit scoring.`},
    'Over 3.5 Sets':{pred:'Over 3.5 Sets',prob:clamp(rnd(45,70),40,75),r:`Close match likely to go 4-5 sets.`},
    'Under 3.5 Sets':{pred:'Under 3.5 Sets',prob:clamp(rnd(35,60),30,65),r:`Dominant player could win in 3 sets.`},
    'Over 5.5 Sets':{pred:'Over 5.5 Sets',prob:clamp(rnd(45,68),38,72),r:`6+ sets in an evenly contested darts match.`},
    '180s Over 3.5':{pred:'Over 3.5 180s',prob:clamp((p.h.att+p.a.att)/2*0.6,45,78),r:`Top players average multiple maximums. 4+ 180s likely.`},
    'DNB Home':{pred:`${home} DNB`,prob:clamp(p.hw+Math.round(p.d*0.5),35,75),r:`Draw No Bet protects stake. ${home} win at ${p.hw}%.`},
  };
  const r=map[mkt]||{pred:mkt,prob:50,r:'Based on statistical analysis.'};
  return{...r,prob:clamp(r.prob,15,92)};
}

async function predict(){
  const home=document.getElementById('homeTeam').value.trim();
  const away=document.getElementById('awayTeam').value.trim();
  const markets=[...document.querySelectorAll('#marketsGrid .market-toggle input:checked')].map(i=>i.value);
  const errEl=document.getElementById('errorMsg');errEl.classList.remove('show');
  if(!home||!away){errEl.textContent='Enter both team names!';errEl.classList.add('show');return;}
  if(!markets.length){errEl.textContent='Select at least one market!';errEl.classList.add('show');return;}
  document.getElementById('loading').classList.add('show');
  document.getElementById('results').classList.remove('show');
  document.getElementById('predictBtn').disabled=true;
  const steps=['Analysing form & H2H...','Computing models...','Running AI engine...','Generating picks...'];
  let si=0;const sEl=document.getElementById('loadingStep');
  const iv=setInterval(()=>{si=(si+1)%steps.length;sEl.textContent=steps[si];},900);
  await new Promise(r=>setTimeout(r,2200));clearInterval(iv);
  const p=calc(home,away);
  const mPreds=markets.map(m=>{const r=getMktPred(m,home,away,p);return{market:m,...r};});
  const dom=Math.abs(p.hw-p.aw);const conf=dom>25?'HIGH':dom>12?'MEDIUM':'LOW';
  const winner=p.hw>p.aw?home:away;const wPct=Math.max(p.hw,p.aw);
  const hG=p.avg>2.8?rnd(2,3):rnd(1,2);const aG=p.hw>55?rnd(0,1):rnd(0,2);
  const best=mPreds.reduce((b,m)=>m.prob>b.prob?m:b,mPreds[0]);
  document.getElementById('loading').classList.remove('show');document.getElementById('predictBtn').disabled=false;
  const cc=conf==='HIGH'?'conf-high':conf==='MEDIUM'?'conf-med':'conf-low';
  const ce=conf==='HIGH'?'üî•':conf==='MEDIUM'?'‚ö°':'‚ö†Ô∏è';
  const icons=['üìä','‚öΩ','üèÜ','üí™'];
  let html=`<div class="match-header">
    <div class="match-teams">${home} <span style="color:var(--muted);font-size:16px">vs</span> ${away}</div>
    <div style="font-size:11px;color:var(--muted)">${currentLeagueName} ‚Ä¢ Predicted: <span style="color:var(--green);font-weight:600">${hG}-${aG}</span></div>
    <div class="confidence-banner ${cc}">${ce} ${conf} CONFIDENCE</div>
    <div style="margin-top:10px;font-size:12px;color:var(--muted)">${winner} favoured at ${wPct}%. ${conf==='HIGH'?'Strong opportunity.':conf==='MEDIUM'?'Moderate value.':'Competitive.'}</div>
  </div>
  <div class="best-bet-banner"><span style="font-size:18px">‚≠ê</span>
    <div><div style="font-size:10px;letter-spacing:2px;color:var(--green);font-family:'JetBrains Mono',monospace">BEST BET</div>
    <div style="font-size:13px;font-weight:600;margin-top:2px">${best.pred} ‚Äî ${best.prob}%</div></div>
  </div>`;
  mPreds.forEach(m=>{
    const pct=clamp(m.prob,0,100);const fc=pct>=65?'':(pct>=45?'warning':'danger');
    const vc=pct>=60?'YES':pct>=42?'MAYBE':'NO';
    html+=`<div class="market-card ${fc}">
      <div class="market-card-top"><div class="market-card-name">${m.market}</div>
      <div class="market-card-verdict ${vc==='YES'?'verdict-yes':vc==='NO'?'verdict-no':'verdict-maybe'}">${vc}</div></div>
      <div class="market-card-prediction">${m.pred}</div>
      <div class="prob-bar-wrap"><div class="prob-label"><span>Probability</span><span>${pct}%</span></div>
      <div class="prob-bar"><div class="prob-fill ${fc}" style="width:0%" data-pct="${pct}"></div></div></div>
      <div class="market-reasoning">${m.r}</div></div>`;
  });
  const factors=[`${home} home strength: ${p.h.home}/100`,`Attack vs Defence: ${home}(${p.h.att}) vs ${away}(${p.a.def})`,`Form: ${home} ${p.h.form}/100 vs ${away} ${p.a.form}/100`,`Expected goals: ${p.avg.toFixed(1)} ‚Äî ${p.avg>2.5?'High scoring':'Tight game'}`];
  html+=`<div class="factors-card"><span class="section-label">üîç Key Factors</span>${factors.map((f,i)=>`<div class="factor-item"><span style="font-size:14px;flex-shrink:0">${icons[i]}</span><span>${f}</span></div>`).join('')}</div>`;
  const el=document.getElementById('results');el.innerHTML=html;el.classList.add('show');
  setTimeout(()=>{document.querySelectorAll('.prob-fill[data-pct]').forEach(e=>e.style.width=e.dataset.pct+'%');},100);
  el.scrollIntoView({behavior:'smooth',block:'start'});
}

// H2H with real SofaScore data
async function loadH2H(){
  const home=document.getElementById('h2hHome').value.trim();
  const away=document.getElementById('h2hAway').value.trim();
  const errEl=document.getElementById('h2hError');errEl.classList.remove('show');
  if(!home||!away){errEl.textContent='Enter both team names!';errEl.classList.add('show');return;}
  document.getElementById('h2hLoading').style.display='block';
  document.getElementById('h2hResults').innerHTML='';

  let realH2H=null;
  try{
    // Search for team IDs
    const r1=await fetch(`https://sofascore.p.rapidapi.com/teams/search?name=${encodeURIComponent(home)}`,{headers:{'x-rapidapi-key':API_KEY,'x-rapidapi-host':'sofascore.p.rapidapi.com'}});
    const d1=await r1.json();
    const r2=await fetch(`https://sofascore.p.rapidapi.com/teams/search?name=${encodeURIComponent(away)}`,{headers:{'x-rapidapi-key':API_KEY,'x-rapidapi-host':'sofascore.p.rapidapi.com'}});
    const d2=await r2.json();
    const t1=(d1.teams||d1.data||[])[0];
    const t2=(d2.teams||d2.data||[])[0];
    if(t1&&t2){
      const r3=await fetch(`https://sofascore.p.rapidapi.com/teams/get-h2h?homeTeamId=${t1.id}&awayTeamId=${t2.id}`,{headers:{'x-rapidapi-key':API_KEY,'x-rapidapi-host':'sofascore.p.rapidapi.com'}});
      const d3=await r3.json();
      realH2H=d3;
    }
  } catch(e){}

  document.getElementById('h2hLoading').style.display='none';

  if(realH2H&&(realH2H.events||realH2H.data||realH2H.teamDuel)){
    renderRealH2H(home,away,realH2H);
  } else {
    renderGeneratedH2H(home,away);
  }
}

function renderRealH2H(home,away,data){
  const events=data.events||data.data||data.matches||[];
  const duel=data.teamDuel||{};
  let hW=duel.homeWins||0,aW=duel.awayWins||0,d=duel.draws||0;
  if(events.length&&!hW){
    events.forEach(e=>{
      const hs=e.homeScore?.current||e.homeScore?.normaltime||0;
      const as=e.awayScore?.current||e.awayScore?.normaltime||0;
      if(hs>as)hW++;else if(as>hs)aW++;else d++;
    });
  }
  const total=hW+aW+d||1;
  const hPct=Math.round(hW/total*100);const aPct=Math.round(aW/total*100);const dPct=100-hPct-aPct;
  const avgG=events.length?events.reduce((s,e)=>{const hs=e.homeScore?.current||0;const as=e.awayScore?.current||0;return s+hs+as;},0)/events.length:2.5;
  const btts=events.length?Math.round(events.filter(e=>(e.homeScore?.current||0)>0&&(e.awayScore?.current||0)>0).length/events.length*100):55;

  let html=`<div style="background:rgba(0,255,135,0.08);border:1px solid var(--green);border-radius:8px;padding:8px 12px;margin-bottom:10px;font-size:11px;color:var(--green)">‚úÖ REAL H2H DATA from SofaScore</div>
  <div class="h2h-card">
    <span class="section-label">‚öîÔ∏è Overall H2H ‚Äî Last ${total} Matches</span>
    <div class="h2h-overview">
      <div class="h2h-team-stat"><div class="h2h-wins">${hW}</div><div class="h2h-label">${home.substring(0,10)} WINS</div><div style="font-size:11px;color:var(--green);margin-top:4px">${hPct}%</div></div>
      <div class="h2h-draw-box"><div class="h2h-draw-num">${d}</div><div class="h2h-label">DRAWS</div><div style="font-size:11px;color:var(--yellow);margin-top:4px">${dPct}%</div></div>
      <div class="h2h-team-stat"><div class="h2h-wins" style="color:var(--red)">${aW}</div><div class="h2h-label">${away.substring(0,10)} WINS</div><div style="font-size:11px;color:var(--red);margin-top:4px">${aPct}%</div></div>
    </div>
    <div class="h2h-bar"><div class="h2h-bar-home" style="width:${hPct}%"></div><div class="h2h-bar-draw" style="width:${dPct}%"></div><div class="h2h-bar-away" style="width:${aPct}%"></div></div>
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-num">${avgG.toFixed(1)}</div><div class="stat-label">Avg Goals/Match</div></div>
      <div class="stat-box"><div class="stat-num">${btts}%</div><div class="stat-label">BTTS Rate</div></div>
    </div>
  </div>`;

  if(events.length){
    html+=`<div class="h2h-card"><span class="section-label">üìÖ Recent Meetings</span>`;
    events.slice(0,8).forEach(e=>{
      const hs=e.homeScore?.current||e.homeScore?.normaltime||0;
      const as=e.awayScore?.current||e.awayScore?.normaltime||0;
      const result=hs>as?'H':hs<as?'A':'D';
      const hn=e.homeTeam?.name||home;const an=e.awayTeam?.name||away;
      const ts=e.startTimestamp;const dateStr=ts?new Date(ts*1000).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}):'';
      html+=`<div class="h2h-match"><div style="font-size:10px;color:var(--muted)">${dateStr}</div><div style="font-weight:600;font-size:12px">${hn} <span class="h2h-score">${hs}-${as}</span> ${an}</div><div class="h2h-result-badge ${result==='H'?'badge-h':result==='D'?'badge-d':'badge-a'}">${result==='H'?hn.substring(0,3).toUpperCase():result==='D'?'DRW':an.substring(0,3).toUpperCase()}</div></div>`;
    });
    html+=`</div>`;
  }
  document.getElementById('h2hResults').innerHTML=html;
}

function renderGeneratedH2H(home,away){
  const hS=gs(home),aS=gs(away);
  const total=rnd(10,20);
  const hWR=clamp(Math.round((hS.form-aS.form)/2+50+rnd(-8,8)),25,62);
  const aWR=clamp(Math.round((aS.form-hS.form)/2+35+rnd(-8,8)),15,48);
  const dR=100-hWR-aWR;
  const hW=Math.round(total*hWR/100),aW=Math.round(total*aWR/100),d=total-hW-aW;
  const avg=((hS.att+aS.att)/2/100*3.2).toFixed(1);
  const btts=clamp(Math.round((hS.att+aS.att)/2*0.85),40,75);
  const hHG=Math.round(total/2);const hHW=Math.round(hHG*(hWR+8)/100);const hHL=Math.round(hHG*(aWR-5)/100);const hHD=hHG-hHW-hHL;
  const aHG=total-hHG;const aHW=Math.max(0,hW-hHW);const aHL=Math.max(0,aW-hHL);const aHD=Math.max(0,d-hHD);
  const recent=[];
  for(let i=0;i<5;i++){const hg=rnd(0,3),ag=rnd(0,3);const res=hg>ag?'H':hg<ag?'A':'D';const dt=new Date();dt.setMonth(dt.getMonth()-i*2-rnd(0,1));recent.push({home,away,hg,ag,res,date:dt.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})});}
  document.getElementById('h2hResults').innerHTML=`
  <div style="background:rgba(255,215,0,0.08);border:1px solid var(--yellow);border-radius:8px;padding:8px 12px;margin-bottom:10px;font-size:11px;color:var(--yellow)">‚ö†Ô∏è Team not found in database ‚Äî showing AI-estimated stats</div>
  <div class="h2h-card">
    <span class="section-label">‚öîÔ∏è Overall H2H ‚Äî Last ${total} Matches</span>
    <div class="h2h-overview">
      <div class="h2h-team-stat"><div class="h2h-wins">${hW}</div><div class="h2h-label">${home.substring(0,10)} WINS</div><div style="font-size:11px;color:var(--green);margin-top:4px">${hWR}%</div></div>
      <div class="h2h-draw-box"><div class="h2h-draw-num">${d}</div><div class="h2h-label">DRAWS</div><div style="font-size:11px;color:var(--yellow);margin-top:4px">${dR}%</div></div>
      <div class="h2h-team-stat"><div class="h2h-wins" style="color:var(--red)">${aW}</div><div class="h2h-label">${away.substring(0,10)} WINS</div><div style="font-size:11px;color:var(--red);margin-top:4px">${aWR}%</div></div>
    </div>
    <div class="h2h-bar"><div class="h2h-bar-home" style="width:${hWR}%"></div><div class="h2h-bar-draw" style="width:${dR}%"></div><div class="h2h-bar-away" style="width:${aWR}%"></div></div>
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-num">${avg}</div><div class="stat-label">Avg Goals</div></div>
      <div class="stat-box"><div class="stat-num">${btts}%</div><div class="stat-label">BTTS Rate</div></div>
      <div class="stat-box"><div class="stat-num">${hHW}/${hHG}</div><div class="stat-label">${home.substring(0,8)} Home W/P</div></div>
      <div class="stat-box"><div class="stat-num">${aHW}/${aHG}</div><div class="stat-label">${home.substring(0,8)} Away W/P</div></div>
    </div>
  </div>
  <div class="h2h-card"><span class="section-label">üè† Home Record ‚Äî ${home}</span>
    <div class="stat-grid">
      <div class="stat-box"><div class="stat-num" style="color:var(--green)">${hHW}</div><div class="stat-label">Home Wins</div></div>
      <div class="stat-box"><div class="stat-num" style="color:var(--yellow)">${Math.max(0,hHD)}</div><div class="stat-label">Home Draws</div></div>
      <div class="stat-box"><div class="stat-num" style="color:var(--red)">${Math.max(0,hHL)}</div><div class="stat-label">Home Losses</div></div>
      <div class="stat-box"><div class="stat-num">${Math.round(hHW/hHG*100)}%</div><div class="stat-label">Win Rate</div></div>
    </div>
  </div>
  <div class="h2h-card"><span class="section-label">üìÖ Recent Meetings</span>
    ${recent.map(m=>`<div class="h2h-match"><div style="font-size:10px;color:var(--muted)">${m.date}</div><div style="font-weight:600;font-size:12px">${m.home} <span class="h2h-score">${m.hg}-${m.ag}</span> ${m.away}</div><div class="h2h-result-badge ${m.res==='H'?'badge-h':m.res==='D'?'badge-d':'badge-a'}">${m.res==='H'?m.home.substring(0,3).toUpperCase():m.res==='D'?'DRW':m.away.substring(0,3).toUpperCase()}</div></div>`).join('')}
  </div>`;
}

// Accumulator
function addToAccum(){
  const home=document.getElementById('accumHome').value.trim();const away=document.getElementById('accumAway').value.trim();
  const errEl=document.getElementById('accumError');errEl.classList.remove('show');
  if(!home||!away){errEl.textContent='Enter both teams!';errEl.classList.add('show');return;}
  if(accumItems.length>=8){errEl.textContent='Max 8 matches!';errEl.classList.add('show');return;}
  const p=calc(home,away);
  const pp={'Home Win':p.hw,'Away Win':p.aw,'Draw':p.d,'BTTS Yes':p.btts,'Over 2.5':p.o25,'Over 1.5':p.o15,'Under 2.5':100-p.o25,'Over 3.5':p.o35,'HT Draw':p.htD,'HT Home Win':p.htHW,'Corners O9.5':clamp(p.corners-rnd(12,18),38,65),'DNB Home':clamp(p.hw+Math.round(p.d*0.5),35,75)};
  const prob=clamp((pp[accumPickType]||50)+rnd(-5,5),18,85);
  const bo={'Home Win':[1.4,2.8],'Away Win':[2.0,5.0],'Draw':[2.8,4.2],'BTTS Yes':[1.5,2.2],'Over 2.5':[1.5,2.2],'Over 1.5':[1.2,1.8],'Under 2.5':[1.5,2.4],'Over 3.5':[2.2,4.0],'HT Draw':[2.0,3.2],'HT Home Win':[2.0,3.5],'Corners O9.5':[1.6,2.5],'DNB Home':[1.3,2.0]};
  const range=bo[accumPickType]||[1.5,2.5];
  const odds=Math.max(1.15,Math.round((range[0]+Math.random()*(range[1]-range[0]))*100)/100);
  accumItems.push({home,away,pick:accumPickType,odds,prob,id:Date.now()});
  document.getElementById('accumHome').value='';document.getElementById('accumAway').value='';renderAccum();
}
function removeAccumItem(id){accumItems=accumItems.filter(i=>i.id!==id);renderAccum();}
function clearAccum(){accumItems=[];renderAccum();}
function renderAccum(){
  const list=document.getElementById('accumList');const bar=document.getElementById('totalOddsBar');
  if(!accumItems.length){list.innerHTML='';bar.style.display='none';return;}
  let tO=1,tP=1;
  list.innerHTML=accumItems.map((item,idx)=>{tO*=item.odds;tP*=item.prob/100;const cc=item.prob>=60?'var(--green)':item.prob>=45?'var(--yellow)':'var(--red)';
    return`<div class="odds-card"><button class="remove-btn" onclick="removeAccumItem(${item.id})">‚úï</button>
      <div style="display:flex;align-items:center;gap:7px;margin-bottom:5px"><span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted)">#${idx+1}</span><span class="odds-badge">${item.odds.toFixed(2)}x</span></div>
      <div style="font-size:13px;font-weight:600">${item.home} vs ${item.away}</div>
      <div style="font-size:11px;color:var(--green);margin-top:2px">üìå ${item.pick}</div>
      <div style="display:flex;align-items:center;gap:7px;margin-top:7px"><div class="prob-bar" style="flex:1;height:4px"><div class="prob-fill" style="width:${item.prob}%;background:${cc}"></div></div><span style="font-size:10px;color:var(--muted)">${item.prob}%</span></div>
    </div>`;}).join('');
  tO=Math.round(tO*100)/100;bar.style.display='flex';
  document.getElementById('totalOddsNum').textContent=tO.toFixed(2)+'x';
  document.getElementById('totalProbNum').textContent=Math.round(tP*100)+'%';
  document.getElementById('totalOddsNum').style.color=tO>=50?'var(--red)':tO>=20?'var(--yellow)':'var(--green)';
  document.getElementById('totalOddsInfo').textContent=`${accumItems.length} match accumulator ‚Ä¢ ${tO>=10?'üî• High odds!':'‚ö° Building...'}`;
}

// Smart odds
function selOdds(el,r){document.querySelectorAll('[id^="odds_"]').forEach(b=>b.classList.remove('active'));el.classList.add('active');selOddsRange=r;}
function selNum(el,n){document.querySelectorAll('[id^="nm_"]').forEach(b=>b.classList.remove('active'));el.classList.add('active');selNumM=n;}
function selMkt(el,t){document.querySelectorAll('[id^="mt_"]').forEach(b=>b.classList.remove('active'));el.classList.add('active');selMktType=t;}

const ALL_TEAMS=[['Man City','Arsenal'],['Liverpool','Chelsea'],['Real Madrid','Barcelona'],['Bayern Munich','Dortmund'],['PSG','Marseille'],['Inter Milan','Juventus'],['Atletico Madrid','Sevilla'],['Napoli','AC Milan'],['Newcastle','Aston Villa'],['RB Leipzig','Leverkusen'],['Ajax','PSV'],['Benfica','Porto'],['Galatasaray','Fenerbahce'],['Al Hilal','Al Nassr'],['Man Utd','Tottenham'],['Lyon','Monaco'],['Roma','Lazio'],['Fiorentina','Atalanta'],['Brighton','West Ham'],['Celtic','Rangers']];

function generateSmartOdds(){
  const mPools={all:['Home Win','Away Win','BTTS','Over 2.5','Over 1.5','Under 2.5','HT Draw','HT Home Win','Corners Over 9.5','Over 3.5','Under 3.5'],goals:['Over 1.5','Over 2.5','Under 2.5','Over 3.5','Under 3.5','Under 4.5'],wins:['Home Win','Away Win','Home Win/Draw','Away Win/Draw'],btts:['BTTS','BTTS No'],ht:['HT Draw','HT Home Win','HT Away Win','HT Home Win/Draw'],sure:['Over 1.5','Under 4.5','Home Win/Draw','Away Win/Draw','HT Draw']};
  const mPool=mPools[selMktType]||mPools.all;
  const slips=[];
  for(let s=0;s<3;s++){
    const shuffled=[...ALL_TEAMS].sort(()=>Math.random()-0.5);const chosen=shuffled.slice(0,selNumM);
    let tO=1,tP=1;
    const items=chosen.map(([home,away])=>{const market=mPool[rnd(0,mPool.length-1)];const p=calc(home,away);const mr=getMktPred(market,home,away,p);const baseO=100/Math.max(10,mr.prob);const odds=Math.max(1.1,Math.round(baseO*(0.85+Math.random()*0.3)*100)/100);tO*=odds;tP*=mr.prob/100;return{home,away,market,pick:mr.pred,odds,prob:mr.prob};});
    slips.push({items,totalOdds:Math.round(tO*100)/100,totalProb:Math.round(tP*10000)/100});
  }
  document.getElementById('smartResults').innerHTML=slips.map((slip,si)=>{
    const color=slip.totalOdds>=100?'var(--red)':slip.totalOdds>=50?'var(--yellow)':'var(--green)';
    return`<div class="odds-generator-result">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <div><div style="font-size:10px;letter-spacing:2px;color:var(--muted);font-family:'JetBrains Mono',monospace">SLIP ${si+1}</div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;color:${color}">${slip.totalOdds.toFixed(2)}x</div></div>
        <div style="text-align:right"><div style="font-size:10px;color:var(--muted)">Win probability</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:16px;color:var(--green)">${slip.totalProb}%</div></div>
      </div>
      ${slip.items.map(item=>`<div class="bet-slip-item">
        <div><div style="font-weight:600;font-size:12px">${item.home} vs ${item.away}</div>
        <div style="font-size:11px;color:var(--green)">${item.pick}</div>
        <div class="slip-prob">${item.prob}% probability</div></div>
        <div class="slip-odds">${item.odds.toFixed(2)}x</div></div>`).join('')}
    </div>`;}).join('');
  document.getElementById('smartResults').scrollIntoView({behavior:'smooth',block:'start'});
}

init();
</script>
</body>
</html>
